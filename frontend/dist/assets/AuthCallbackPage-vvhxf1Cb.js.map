{"version":3,"file":"AuthCallbackPage-vvhxf1Cb.js","sources":["../../src/pages/auth/AuthCallbackPage.tsx"],"sourcesContent":["/**\r\n * =============================================================================\r\n * PÁGINA DE CALLBACK DE AUTENTICACIÓN\r\n * =============================================================================\r\n * \r\n * Maneja el callback de magic links y OAuth.\r\n * Procesa el token y redirige según el estado del perfil.\r\n */\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { supabase } from '@/lib/supabase';\r\nimport { Spinner } from '@/components/ui/LoadingStates';\r\n\r\ntype CallbackStatus = 'processing' | 'success' | 'error';\r\n\r\nexport default function AuthCallbackPage() {\r\n  const navigate = useNavigate();\r\n  const [searchParams] = useSearchParams();\r\n  const [status, setStatus] = useState<CallbackStatus>('processing');\r\n  const [errorMessage, setErrorMessage] = useState('');\r\n\r\n  useEffect(() => {\r\n    async function handleCallback() {\r\n      try {\r\n        // Supabase maneja el hash fragment automáticamente\r\n        const { data: { session }, error } = await supabase.auth.getSession();\r\n\r\n        if (error) {\r\n          throw error;\r\n        }\r\n\r\n        if (!session) {\r\n          // Puede que el token esté en el hash, intentar extraerlo\r\n          const hashParams = new URLSearchParams(window.location.hash.substring(1));\r\n          const accessToken = hashParams.get('access_token');\r\n          const refreshToken = hashParams.get('refresh_token');\r\n\r\n          if (accessToken && refreshToken) {\r\n            const { error: setError } = await supabase.auth.setSession({\r\n              access_token: accessToken,\r\n              refresh_token: refreshToken,\r\n            });\r\n\r\n            if (setError) {\r\n              throw setError;\r\n            }\r\n          } else {\r\n            throw new Error('No se encontró una sesión válida');\r\n          }\r\n        }\r\n\r\n        setStatus('success');\r\n\r\n        // Verificar si el perfil está completo\r\n        const { data: profile } = await (supabase as any)\r\n          .from('profiles')\r\n          .select('is_complete')\r\n          .single();\r\n\r\n        // Redirigir según estado del perfil\r\n        setTimeout(() => {\r\n          if (profile?.is_complete) {\r\n            navigate('/dashboard', { replace: true });\r\n          } else {\r\n            navigate('/complete-profile', { replace: true });\r\n          }\r\n        }, 1000);\r\n\r\n      } catch (error) {\r\n        console.error('Auth callback error:', error);\r\n        setStatus('error');\r\n        setErrorMessage(\r\n          error instanceof Error \r\n            ? error.message \r\n            : 'No se pudo completar la autenticación'\r\n        );\r\n      }\r\n    }\r\n\r\n    handleCallback();\r\n  }, [navigate, searchParams]);\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-surface-950 via-surface-900 to-surface-950\">\r\n      <div className=\"text-center\">\r\n        {status === 'processing' && (\r\n          <>\r\n            <Spinner size=\"lg\" className=\"mx-auto mb-4\" />\r\n            <h1 className=\"text-xl font-medium text-white mb-2\">\r\n              Verificando...\r\n            </h1>\r\n            <p className=\"text-surface-400\">\r\n              Estamos procesando tu inicio de sesión\r\n            </p>\r\n          </>\r\n        )}\r\n\r\n        {status === 'success' && (\r\n          <>\r\n            <div className=\"w-16 h-16 rounded-full bg-green-500/20 flex items-center justify-center mx-auto mb-4\">\r\n              <CheckIcon className=\"w-8 h-8 text-green-400\" />\r\n            </div>\r\n            <h1 className=\"text-xl font-medium text-white mb-2\">\r\n              ¡Listo!\r\n            </h1>\r\n            <p className=\"text-surface-400\">\r\n              Redirigiendo...\r\n            </p>\r\n          </>\r\n        )}\r\n\r\n        {status === 'error' && (\r\n          <>\r\n            <div className=\"w-16 h-16 rounded-full bg-red-500/20 flex items-center justify-center mx-auto mb-4\">\r\n              <XIcon className=\"w-8 h-8 text-red-400\" />\r\n            </div>\r\n            <h1 className=\"text-xl font-medium text-white mb-2\">\r\n              Error de autenticación\r\n            </h1>\r\n            <p className=\"text-surface-400 mb-6\">\r\n              {errorMessage}\r\n            </p>\r\n            <a\r\n              href=\"/login\"\r\n              className=\"inline-flex items-center gap-2 px-4 py-2 bg-primary-600 hover:bg-primary-500 text-white rounded-lg transition-colors\"\r\n            >\r\n              Volver a intentar\r\n            </a>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// =============================================================================\r\n// ICONS\r\n// =============================================================================\r\n\r\nfunction CheckIcon({ className }: { className?: string }) {\r\n  return (\r\n    <svg className={className} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M5 13l4 4L19 7\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nfunction XIcon({ className }: { className?: string }) {\r\n  return (\r\n    <svg className={className} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M6 18L18 6M6 6l12 12\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\n"],"names":["AuthCallbackPage","navigate","useNavigate","searchParams","useSearchParams","status","setStatus","useState","errorMessage","setErrorMessage","useEffect","handleCallback","session","error","supabase","hashParams","accessToken","refreshToken","setError","profile","jsxs","Fragment","jsx","Spinner","CheckIcon","XIcon","className"],"mappings":"6KAgBA,SAAwBA,GAAmB,CACzC,MAAMC,EAAWC,EAAA,EACX,CAACC,CAAY,EAAIC,EAAA,EACjB,CAACC,EAAQC,CAAS,EAAIC,EAAAA,SAAyB,YAAY,EAC3D,CAACC,EAAcC,CAAe,EAAIF,EAAAA,SAAS,EAAE,EAEnDG,OAAAA,EAAAA,UAAU,IAAM,CACd,eAAeC,GAAiB,CAC9B,GAAI,CAEF,KAAM,CAAE,KAAM,CAAE,QAAAC,CAAA,EAAW,MAAAC,GAAU,MAAMC,EAAS,KAAK,WAAA,EAEzD,GAAID,EACF,MAAMA,EAGR,GAAI,CAACD,EAAS,CAEZ,MAAMG,EAAa,IAAI,gBAAgB,OAAO,SAAS,KAAK,UAAU,CAAC,CAAC,EAClEC,EAAcD,EAAW,IAAI,cAAc,EAC3CE,EAAeF,EAAW,IAAI,eAAe,EAEnD,GAAIC,GAAeC,EAAc,CAC/B,KAAM,CAAE,MAAOC,CAAA,EAAa,MAAMJ,EAAS,KAAK,WAAW,CACzD,aAAcE,EACd,cAAeC,CAAA,CAChB,EAED,GAAIC,EACF,MAAMA,CAEV,KACE,OAAM,IAAI,MAAM,kCAAkC,CAEtD,CAEAZ,EAAU,SAAS,EAGnB,KAAM,CAAE,KAAMa,CAAA,EAAY,MAAOL,EAC9B,KAAK,UAAU,EACf,OAAO,aAAa,EACpB,OAAA,EAGH,WAAW,IAAM,CACXK,GAAA,MAAAA,EAAS,YACXlB,EAAS,aAAc,CAAE,QAAS,EAAA,CAAM,EAExCA,EAAS,oBAAqB,CAAE,QAAS,EAAA,CAAM,CAEnD,EAAG,GAAI,CAET,OAASY,EAAO,CACd,QAAQ,MAAM,uBAAwBA,CAAK,EAC3CP,EAAU,OAAO,EACjBG,EACEI,aAAiB,MACbA,EAAM,QACN,uCAAA,CAER,CACF,CAEAF,EAAA,CACF,EAAG,CAACV,EAAUE,CAAY,CAAC,QAGxB,MAAA,CAAI,UAAU,sHACb,SAAAiB,EAAAA,KAAC,MAAA,CAAI,UAAU,cACZ,SAAA,CAAAf,IAAW,cACVe,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAC,EAAAA,IAACC,EAAA,CAAQ,KAAK,KAAK,UAAU,eAAe,EAC5CD,EAAAA,IAAC,KAAA,CAAG,UAAU,sCAAsC,SAAA,iBAEpD,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,mBAAmB,SAAA,wCAAA,CAEhC,CAAA,EACF,EAGDjB,IAAW,WACVe,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAC,EAAAA,IAAC,OAAI,UAAU,uFACb,eAACE,EAAA,CAAU,UAAU,yBAAyB,CAAA,CAChD,EACAF,EAAAA,IAAC,KAAA,CAAG,UAAU,sCAAsC,SAAA,UAEpD,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,mBAAmB,SAAA,iBAAA,CAEhC,CAAA,EACF,EAGDjB,IAAW,SACVe,EAAAA,KAAAC,EAAAA,SAAA,CACE,SAAA,CAAAC,EAAAA,IAAC,OAAI,UAAU,qFACb,eAACG,EAAA,CAAM,UAAU,uBAAuB,CAAA,CAC1C,EACAH,EAAAA,IAAC,KAAA,CAAG,UAAU,sCAAsC,SAAA,yBAEpD,EACAA,EAAAA,IAAC,IAAA,CAAE,UAAU,wBACV,SAAAd,EACH,EACAc,EAAAA,IAAC,IAAA,CACC,KAAK,SACL,UAAU,uHACX,SAAA,mBAAA,CAAA,CAED,CAAA,CACF,CAAA,CAAA,CAEJ,CAAA,CACF,CAEJ,CAMA,SAASE,EAAU,CAAE,UAAAE,GAAqC,CACxD,aACG,MAAA,CAAI,UAAAA,EAAsB,KAAK,OAAO,QAAQ,YAAY,OAAO,eAAe,YAAY,IAC3F,SAAAJ,EAAAA,IAAC,QAAK,cAAc,QAAQ,eAAe,QAAQ,EAAE,iBAAiB,CAAA,CACxE,CAEJ,CAEA,SAASG,EAAM,CAAE,UAAAC,GAAqC,CACpD,aACG,MAAA,CAAI,UAAAA,EAAsB,KAAK,OAAO,QAAQ,YAAY,OAAO,eAAe,YAAY,IAC3F,SAAAJ,EAAAA,IAAC,QAAK,cAAc,QAAQ,eAAe,QAAQ,EAAE,uBAAuB,CAAA,CAC9E,CAEJ"}