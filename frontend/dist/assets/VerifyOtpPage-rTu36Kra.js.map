{"version":3,"file":"VerifyOtpPage-rTu36Kra.js","sources":["../../src/pages/auth/VerifyOtpPage.tsx"],"sourcesContent":["/**\r\n * =============================================================================\r\n * PÁGINA DE VERIFICACIÓN OTP\r\n * =============================================================================\r\n * \r\n * Verificación de código enviado por email o SMS.\r\n * Incluye reenvío y cuenta regresiva.\r\n */\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { useLocation, useNavigate, Navigate } from 'react-router-dom';\r\nimport { useAuth } from '@/hooks/useAuth';\r\nimport { validate, otpSchema } from '@/lib/validations';\r\nimport { Button, LinkButton } from '@/components/ui/Button';\r\nimport { FormField, OtpInput } from '@/components/ui/FormField';\r\n\r\nconst RESEND_COOLDOWN = 60; // segundos\r\n\r\ninterface LocationState {\r\n  type: 'email' | 'phone';\r\n  contact: string;\r\n}\r\n\r\nexport default function VerifyOtpPage() {\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { verifyOtp, signInWithEmail, signInWithPhone, isLoading } = useAuth();\r\n\r\n  const state = location.state as LocationState | null;\r\n  \r\n  const [otp, setOtp] = useState('');\r\n  const [error, setError] = useState('');\r\n  const [resendCooldown, setResendCooldown] = useState(RESEND_COOLDOWN);\r\n  const [isResending, setIsResending] = useState(false);\r\n\r\n  // Redirect si no hay state\r\n  if (!state?.type || !state?.contact) {\r\n    return <Navigate to=\"/login\" replace />;\r\n  }\r\n\r\n  // Cooldown timer\r\n  useEffect(() => {\r\n    if (resendCooldown <= 0) return;\r\n    \r\n    const timer = setInterval(() => {\r\n      setResendCooldown((prev) => prev - 1);\r\n    }, 1000);\r\n\r\n    return () => clearInterval(timer);\r\n  }, [resendCooldown]);\r\n\r\n  // Auto-submit cuando se completa el código\r\n  useEffect(() => {\r\n    if (otp.length === 6) {\r\n      handleVerify();\r\n    }\r\n  }, [otp]);\r\n\r\n  const handleVerify = useCallback(async () => {\r\n    setError('');\r\n\r\n    const validation = validate(otpSchema, { otp });\r\n    if (!validation.success) {\r\n      setError(validation.errors?.otp ?? 'Código inválido');\r\n      return;\r\n    }\r\n\r\n    const success = await verifyOtp(otp, state.type, state.contact);\r\n    if (!success) {\r\n      setOtp(''); // Limpiar para reintentar\r\n    }\r\n  }, [otp, state, verifyOtp]);\r\n\r\n  const handleResend = useCallback(async () => {\r\n    setIsResending(true);\r\n    setError('');\r\n\r\n    const success = state.type === 'email'\r\n      ? await signInWithEmail(state.contact)\r\n      : await signInWithPhone(state.contact);\r\n\r\n    if (success) {\r\n      setResendCooldown(RESEND_COOLDOWN);\r\n    }\r\n\r\n    setIsResending(false);\r\n  }, [state, signInWithEmail, signInWithPhone]);\r\n\r\n  const handleChangeMethod = () => {\r\n    navigate('/login');\r\n  };\r\n\r\n  const maskedContact = state.type === 'email'\r\n    ? maskEmail(state.contact)\r\n    : maskPhone(state.contact);\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-surface-950 via-surface-900 to-surface-950\">\r\n      {/* Background decoration */}\r\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\r\n        <div className=\"absolute -top-1/2 -right-1/2 w-full h-full bg-gradient-to-bl from-primary-500/10 to-transparent rounded-full blur-3xl\" />\r\n      </div>\r\n\r\n      <div className=\"relative w-full max-w-md\">\r\n        {/* Header */}\r\n        <div className=\"text-center mb-8\">\r\n          <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-primary-500 to-primary-600 shadow-lg shadow-primary-500/30 mb-4\">\r\n            {state.type === 'email' ? (\r\n              <MailCheckIcon className=\"w-8 h-8 text-white\" />\r\n            ) : (\r\n              <MessageIcon className=\"w-8 h-8 text-white\" />\r\n            )}\r\n          </div>\r\n          <h1 className=\"text-2xl font-bold text-white mb-2\">\r\n            Verificá tu {state.type === 'email' ? 'email' : 'teléfono'}\r\n          </h1>\r\n          <p className=\"text-surface-400\">\r\n            {state.type === 'email' ? (\r\n              <>Ingresá el código del link que enviamos a <strong className=\"text-surface-200\">{maskedContact}</strong></>\r\n            ) : (\r\n              <>Ingresá el código de 6 dígitos que enviamos a <strong className=\"text-surface-200\">{maskedContact}</strong></>\r\n            )}\r\n          </p>\r\n        </div>\r\n\r\n        {/* Card */}\r\n        <div className=\"bg-surface-900/80 backdrop-blur-xl border border-surface-800 rounded-2xl p-6 shadow-xl\">\r\n          <form onSubmit={(e) => { e.preventDefault(); handleVerify(); }} className=\"space-y-6\">\r\n            <FormField\r\n              label=\"Código de verificación\"\r\n              error={error}\r\n            >\r\n              <OtpInput\r\n                value={otp}\r\n                onChange={setOtp}\r\n                error={!!error}\r\n                disabled={isLoading}\r\n              />\r\n            </FormField>\r\n\r\n            <Button\r\n              type=\"submit\"\r\n              fullWidth\r\n              isLoading={isLoading}\r\n              size=\"lg\"\r\n              disabled={otp.length !== 6}\r\n            >\r\n              Verificar\r\n            </Button>\r\n          </form>\r\n\r\n          {/* Resend */}\r\n          <div className=\"mt-6 text-center\">\r\n            {resendCooldown > 0 ? (\r\n              <p className=\"text-sm text-surface-400\">\r\n                Podés reenviar en{' '}\r\n                <span className=\"font-mono text-surface-200\">\r\n                  {formatTime(resendCooldown)}\r\n                </span>\r\n              </p>\r\n            ) : (\r\n              <Button\r\n                variant=\"ghost\"\r\n                onClick={handleResend}\r\n                isLoading={isResending}\r\n              >\r\n                Reenviar código\r\n              </Button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Change method */}\r\n          <div className=\"mt-4 pt-4 border-t border-surface-800 text-center\">\r\n            <LinkButton variant=\"secondary\" onClick={handleChangeMethod}>\r\n              ← Usar otro método\r\n            </LinkButton>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Tips */}\r\n        <div className=\"mt-6 p-4 bg-surface-800/50 rounded-xl border border-surface-700\">\r\n          <h3 className=\"text-sm font-medium text-surface-200 mb-2\">\r\n            ¿No recibiste el código?\r\n          </h3>\r\n          <ul className=\"text-xs text-surface-400 space-y-1\">\r\n            <li>• Revisá tu carpeta de spam</li>\r\n            <li>• Verificá que el {state.type === 'email' ? 'email' : 'número'} sea correcto</li>\r\n            <li>• Esperá unos segundos y reenviá</li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// =============================================================================\r\n// HELPERS\r\n// =============================================================================\r\n\r\nfunction maskEmail(email: string): string {\r\n  const [local = '', domain = ''] = email.split('@');\r\n  if (local.length <= 3) return `${local.slice(0, 1)}***@${domain}`;\r\n  return `${local.slice(0, 2)}***${local.slice(-1)}@${domain}`;\r\n}\r\n\r\nfunction maskPhone(phone: string): string {\r\n  const clean = phone.replace(/\\D/g, '');\r\n  if (clean.length <= 4) return '****';\r\n  return `***${clean.slice(-4)}`;\r\n}\r\n\r\nfunction formatTime(seconds: number): string {\r\n  const mins = Math.floor(seconds / 60);\r\n  const secs = seconds % 60;\r\n  return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n}\r\n\r\n// =============================================================================\r\n// ICONS\r\n// =============================================================================\r\n\r\nfunction MailCheckIcon({ className }: { className?: string }) {\r\n  return (\r\n    <svg className={className} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nfunction MessageIcon({ className }: { className?: string }) {\r\n  return (\r\n    <svg className={className} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\n"],"names":["RESEND_COOLDOWN","VerifyOtpPage","location","useLocation","navigate","useNavigate","verifyOtp","signInWithEmail","signInWithPhone","isLoading","useAuth","state","otp","setOtp","useState","error","setError","resendCooldown","setResendCooldown","isResending","setIsResending","jsx","Navigate","useEffect","timer","prev","handleVerify","useCallback","validation","validate","otpSchema","_a","handleResend","handleChangeMethod","maskedContact","maskEmail","maskPhone","jsxs","MailCheckIcon","MessageIcon","Fragment","e","FormField","OtpInput","Button","formatTime","LinkButton","email","local","domain","phone","clean","seconds","mins","secs","className"],"mappings":"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"}