import{r as n,e as S}from"./vendor-DW262YiZ.js";import{u as b,a as C,s as f,A as u,b as p}from"./index-QTZiQ_WQ.js";function k(){const[g,a]=n.useState(!1),[d,o]=n.useState(null),l=S(),{logout:h}=b(),s=C(),m=n.useCallback(()=>o(null),[]),y=n.useCallback(async t=>{a(!0),o(null);try{const{error:r}=await f.auth.signInWithOtp({email:t,options:{emailRedirectTo:`${window.location.origin}/auth/callback`}});if(r)throw new u(r.message);return s.success("Email enviado","Revisá tu casilla de correo"),!0}catch(r){const e=r instanceof p?r:new u("No se pudo enviar el email");return o(e),s.error(e.userTitle,e.userMessage),!1}finally{a(!1)}},[s]),v=n.useCallback(async t=>{a(!0),o(null);try{const r=t.startsWith("+")?t:`+54${t}`,{error:e}=await f.auth.signInWithOtp({phone:r});if(e)throw new u(e.message);return s.success("Código enviado","Revisá los SMS de tu teléfono"),!0}catch(r){const e=r instanceof p?r:new u("No se pudo enviar el SMS");return o(e),s.error(e.userTitle,e.userMessage),!1}finally{a(!1)}},[s]),w=n.useCallback(async(t,r,e)=>{a(!0),o(null);try{const c=r==="email"?{email:e,token:t,type:"email"}:{phone:e.startsWith("+")?e:`+54${e}`,token:t,type:"sms"},{error:i}=await f.auth.verifyOtp(c);if(i)throw new u(i.message.includes("expired")?"El código expiró. Solicitá uno nuevo.":"Código incorrecto. Verificá e intentá de nuevo.");return s.success("¡Bienvenido!","Sesión iniciada correctamente"),l("/dashboard"),!0}catch(c){const i=c instanceof p?c:new u("No se pudo verificar el código");return o(i),s.error(i.userTitle,i.userMessage),!1}finally{a(!1)}},[l,s]),E=n.useCallback(async()=>{a(!0);try{await f.auth.signOut(),h(),l("/login"),s.info("Sesión cerrada","Hasta pronto")}catch(t){console.error("Sign out error:",t),h(),l("/login")}finally{a(!1)}},[h,l,s]);return{isLoading:g,error:d,signInWithEmail:y,signInWithPhone:v,verifyOtp:w,signOut:E,clearError:m}}export{k as u};
//# sourceMappingURL=useAuth-CpnnWU2w.js.map
